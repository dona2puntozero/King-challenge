<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pushup Challenge App</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
            min-height: 100vh;
        }
        
        .container {
            min-height: 100vh;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .app-card {
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            padding: 1.5rem;
            width: 100%;
            max-width: 28rem;
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .header h1 {
            font-size: 1.875rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            color: #6b7280;
        }
        
        .users-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        
        .users-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .add-user-btn {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 50%;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .add-user-btn:hover {
            background: #2563eb;
        }
        
        .add-user-form {
            background: #f9fafb;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .form-row {
            display: flex;
            gap: 0.5rem;
        }
        
        .form-input {
            flex: 1;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            outline: none;
            font-size: 0.875rem;
        }
        
        .form-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn-green {
            background: #10b981;
            color: white;
        }
        
        .btn-green:hover {
            background: #059669;
        }
        
        .btn-gray {
            background: #6b7280;
            color: white;
        }
        
        .btn-gray:hover {
            background: #4b5563;
        }
        
        .user-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .user-item {
            background: #f9fafb;
            border-radius: 0.75rem;
            padding: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .user-item:hover {
            background: #f3f4f6;
        }
        
        .user-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .user-avatar {
            width: 2.5rem;
            height: 2.5rem;
            background: #3b82f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .user-details h3 {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }
        
        .user-details p {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .user-progress {
            text-align: right;
        }
        
        .progress-main {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
        }
        
        .progress-main span {
            font-weight: 600;
            color: #1f2937;
        }
        
        .progress-total {
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 0;
        }
        
        .empty-state svg {
            width: 4rem;
            height: 4rem;
            color: #d1d5db;
            margin: 0 auto 1rem;
        }
        
        .empty-state p {
            color: #6b7280;
            margin-bottom: 1rem;
        }
        
        .phase-card {
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .phase-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .phase-title h2 {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }
        
        .phase-title p {
            opacity: 0.9;
        }
        
        .phase-progress {
            margin-bottom: 0.5rem;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        
        .progress-bar {
            width: 100%;
            height: 0.75rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 0.375rem;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 0.375rem;
            transition: width 0.3s ease;
        }
        
        .button-grid {
            display: grid;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }
        
        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .pushup-btn {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .pushup-btn:hover {
            background: #2563eb;
        }
        
        .pushup-btn-green {
            background: #10b981;
        }
        
        .pushup-btn-green:hover {
            background: #059669;
        }
        
        .stats-card {
            background: #f9fafb;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-top: 1.5rem;
        }
        
        .stats-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .stats-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: #374151;
        }
        
        .stats-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1f2937;
        }
        
        .success-card {
            background: #d1fae5;
            border: 1px solid #a7f3d0;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .success-content {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #065f46;
            font-weight: 600;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: #6b7280;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .back-btn:hover {
            color: #374151;
        }
        
        .user-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        
        .user-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1f2937;
        }
        
        .phase-1 { background: #10b981; }
        .phase-2 { background: #3b82f6; }
        .phase-3 { background: #8b5cf6; }
        .phase-4 { background: #f59e0b; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { User, Plus, Check, Target, Calendar, Trophy, Users } = lucide;
        
        const PushupChallengeApp = () => {
            const [users, setUsers] = useState([]);
            const [selectedUser, setSelectedUser] = useState(null);
            const [newUserName, setNewUserName] = useState('');
            const [showAddUser, setShowAddUser] = useState(false);

            useEffect(() => {
                const savedUsers = JSON.parse(localStorage.getItem('pushupUsers') || '[]');
                setUsers(savedUsers);
            }, []);

            useEffect(() => {
                localStorage.setItem('pushupUsers', JSON.stringify(users));
            }, [users]);

            const addUser = () => {
                if (newUserName.trim()) {
                    const newUser = {
                        id: Date.now(),
                        name: newUserName,
                        startDate: new Date().toISOString().split('T')[0],
                        dailyProgress: {},
                        currentStreak: 0,
                        totalPushups: 0
                    };
                    setUsers([...users, newUser]);
                    setNewUserName('');
                    setShowAddUser(false);
                }
            };

            const getCurrentPhase = (startDate) => {
                const start = new Date(startDate);
                const today = new Date();
                const daysPassed = Math.floor((today - start) / (1000 * 60 * 60 * 24));
                
                if (daysPassed < 7) {
                    return { phase: 1, target: 50, daysInPhase: daysPassed + 1, totalDays: 7 };
                } else if (daysPassed < 28) {
                    return { phase: 2, target: 100, daysInPhase: daysPassed - 6, totalDays: 21 };
                } else if (daysPassed < 49) {
                    return { phase: 3, target: 200, daysInPhase: daysPassed - 27, totalDays: 21 };
                } else {
                    return { phase: 4, target: 0, daysInPhase: 0, totalDays: 0 };
                }
            };

            const getTodayKey = () => {
                return new Date().toISOString().split('T')[0];
            };

            const addPushups = (userId, count) => {
                const todayKey = getTodayKey();
                setUsers(users.map(user => {
                    if (user.id === userId) {
                        const newDailyProgress = { ...user.dailyProgress };
                        newDailyProgress[todayKey] = (newDailyProgress[todayKey] || 0) + count;
                        
                        return {
                            ...user,
                            dailyProgress: newDailyProgress,
                            totalPushups: user.totalPushups + count
                        };
                    }
                    return user;
                }));
            };

            const getTodayProgress = (user) => {
                const todayKey = getTodayKey();
                return user.dailyProgress[todayKey] || 0;
            };

            const getPhaseText = (phase) => {
                switch (phase) {
                    case 1: return 'Fase 1 - Riscaldamento';
                    case 2: return 'Fase 2 - Resistenza';
                    case 3: return 'Fase 3 - Potenza';
                    case 4: return 'Challenge Completata!';
                    default: return '';
                }
            };

            if (selectedUser) {
                const user = users.find(u => u.id === selectedUser);
                const phaseInfo = getCurrentPhase(user.startDate);
                const todayProgress = getTodayProgress(user);
                const progressPercentage = phaseInfo.target > 0 ? (todayProgress / phaseInfo.target) * 100 : 100;

                return (
                    <div className="container">
                        <div className="app-card">
                            <div className="user-header">
                                <button
                                    onClick={() => setSelectedUser(null)}
                                    className="back-btn"
                                >
                                    ←
                                </button>
                                <h1 className="user-name">{user.name}</h1>
                                <div style={{width: '2rem'}}></div>
                            </div>

                            <div className={`phase-card phase-${phaseInfo.phase}`}>
                                <div className="phase-header">
                                    <div className="phase-title">
                                        <h2>{getPhaseText(phaseInfo.phase)}</h2>
                                        <p>
                                            {phaseInfo.phase < 4 ? 
                                                `Giorno ${phaseInfo.daysInPhase} di ${phaseInfo.totalDays}` : 
                                                'Congratulazioni! 🎉'
                                            }
                                        </p>
                                    </div>
                                    <Target size={32} style={{opacity: 0.8}} />
                                </div>

                                {phaseInfo.phase < 4 && (
                                    <div className="phase-progress">
                                        <div className="progress-text">
                                            <span style={{opacity: 0.9}}>Obiettivo giornaliero</span>
                                            <span style={{fontWeight: 'bold'}}>{todayProgress}/{phaseInfo.target}</span>
                                        </div>
                                        <div className="progress-bar">
                                            <div 
                                                className="progress-fill"
                                                style={{ width: `${Math.min(progressPercentage, 100)}%` }}
                                            ></div>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {phaseInfo.phase < 4 && (
                                <div className="button-grid">
                                    <div className="button-grid grid-3">
                                        {[5, 10, 15].map(count => (
                                            <button
                                                key={count}
                                                onClick={() => addPushups(user.id, count)}
                                                className="pushup-btn"
                                            >
                                                +{count}
                                            </button>
                                        ))}
                                    </div>
                                    <div className="button-grid grid-2">
                                        {[25, 50].map(count => (
                                            <button
                                                key={count}
                                                onClick={() => addPushups(user.id, count)}
                                                className="pushup-btn pushup-btn-green"
                                            >
                                                +{count}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}

                            <div className="stats-card">
                                <div className="stats-content">
                                    <div className="stats-label">
                                        <Trophy size={20} color="#eab308" />
                                        <span>Totale pushups</span>
                                    </div>
                                    <span className="stats-value">{user.totalPushups}</span>
                                </div>
                            </div>

                            {todayProgress >= phaseInfo.target && phaseInfo.phase < 4 && (
                                <div className="success-card">
                                    <div className="success-content">
                                        <Check size={20} />
                                        <span>Obiettivo giornaliero completato!</span>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            return (
                <div className="container">
                    <div className="app-card">
                        <div className="header">
                            <h1>Pushup Challenge</h1>
                            <p>7 giorni × 50 → 21 giorni × 100 → 21 giorni × 200</p>
                        </div>

                        <div className="users-header">
                            <h2 className="users-title">
                                <Users size={20} />
                                Utenti ({users.length})
                            </h2>
                            <button
                                onClick={() => setShowAddUser(true)}
                                className="add-user-btn"
                            >
                                <Plus size={20} />
                            </button>
                        </div>

                        {showAddUser && (
                            <div className="add-user-form">
                                <div className="form-row">
                                    <input
                                        type="text"
                                        value={newUserName}
                                        onChange={(e) => setNewUserName(e.target.value)}
                                        placeholder="Nome utente"
                                        className="form-input"
                                        onKeyPress={(e) => e.key === 'Enter' && addUser()}
                                    />
                                    <button
                                        onClick={addUser}
                                        className="btn btn-green"
                                    >
                                        Aggiungi
                                    </button>
                                    <button
                                        onClick={() => setShowAddUser(false)}
                                        className="btn btn-gray"
                                    >
                                        Annulla
                                    </button>
                                </div>
                            </div>
                        )}

                        <div className="user-list">
                            {users.map(user => {
                                const phaseInfo = getCurrentPhase(user.startDate);
                                const todayProgress = getTodayProgress(user);
                                const isCompleted = todayProgress >= phaseInfo.target;
                                
                                return (
                                    <div
                                        key={user.id}
                                        onClick={() => setSelectedUser(user.id)}
                                        className="user-item"
                                    >
                                        <div className="user-content">
                                            <div className="user-info">
                                                <div className="user-avatar">
                                                    <User size={20} />
                                                </div>
                                                <div className="user-details">
                                                    <h3>{user.name}</h3>
                                                    <p>{getPhaseText(phaseInfo.phase)}</p>
                                                </div>
                                            </div>
                                            <div className="user-progress">
                                                <div className="progress-main">
                                                    {isCompleted && phaseInfo.phase < 4 && (
                                                        <Check size={16} color="#10b981" />
                                                    )}
                                                    <span>
                                                        {phaseInfo.phase < 4 ? `${todayProgress}/${phaseInfo.target}` : '✓'}
                                                    </span>
                                                </div>
                                                <p className="progress-total">
                                                    Totale: {user.totalPushups}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        {users.length === 0 && (
                            <div className="empty-state">
                                <Users size={64} />
                                <p>Nessun utente registrato</p>
                                <button
                                    onClick={() => setShowAddUser(true)}
                                    className="btn btn-blue"
                                    style={{background: '#3b82f6', color: 'white'}}
                                >
                                    Aggiungi primo utente
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<PushupChallengeApp />, document.getElementById('root'));
    </script>
</body>
</html>
